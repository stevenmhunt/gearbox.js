/* gearbox.js
 * version 0.1
 * written by Steven Hunt
 * released under the MIT License. */
 
var gearbox=gearbox||{version:"0.1"};(function(e){var t=function(e,t,n){this.interval=e!==undefined?e:1e3;this.threshold=t!==undefined?t:50;this.top=n!==undefined?n:10;var r=1;this.currentGear=function(){return r};var i={shift:new Array};this.on=function(e,t){if(!i.hasOwnProperty(e))i[e]=new Array;i[e].push(t)};this.trigger=function(e,t){if(!i.hasOwnProperty(e))return false;for(var n=0;n<i[e].length;n++){i[e][n].apply(this,t)}return true};this.shiftUp=function(){if(r>=this.top)return false;r++;this.trigger("shift");return true};this.shiftDown=function(){if(r<=1)return false;r--;this.trigger("shift");return true};var s=0;var o=0;this.performance=function(){return o};this.status="started";var u=this;var a=null;var f=function(){if(u.status=="stopped")return;setTimeout(a,u.interval)};a=function(){var e=(new Date).getTime();if(s>0){o=e-s-u.interval;if(o>u.threshold){u.shiftUp()}}s=e;f()};this.start=function(){if(this.status=="started")return false;this.status="started";f();return true};this.stop=function(){this.status="stopped"};this.start()};instances={"default":new t};e.get=function(e){if(!instances.hasOwnProperty(e))return false;return instances[e]};e.create=function(e,n,r,i){if(instances.hasOwnProperty(e))return false;instances[e]=new t(n,r,i);return instances[e]};e.destroy=function(e){if(!instances.hasOwnProperty(e))return false;instances[e].stop();delete instances[e];return true}})(gearbox)